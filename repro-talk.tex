\documentclass[12pt,t]{beamer}
\usepackage{graphicx}
\usepackage{tikz}
\setbeameroption{hide notes}
\setbeamertemplate{note page}[plain]
\usepackage{listings}

\input{header.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% end of header
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% title info

\title{Automating Reproducibility}
\subtitle{A Reproducible Data Analysis Workflow with RMarkdown, Git, Make, and Docker}
\author{\href{https://github.com/aaronpeikert/}{Aaron Peikert\textsuperscript{1,2}}, Andreas M. Brandmaier\textsuperscript{1,2,3}}
\institute{
\textsuperscript{1}Center for Lifespan Psychology---Max Planck Institute for Human Development, Berlin, Germany\\
\textsuperscript{2}Max Planck UCL Centre for Computational Psychiatry and Ageing Research, Berlin, Germany and London, UK\\
\textsuperscript{3}MSB Medical School Berlin, Germany
}
\date{
06.04.2022 - COMP2PSYCH\\
\scriptsize {\lolit Slides:} \href{https://github.com/aaronpeikert/repro-talk/releases}{\tt \scriptsize
  \color{foreground} https://github.com/aaronpeikert/repro-talk}
}


\begin{document}

% title slide
{
{
\setbeamertemplate{footline}{} % no page number here
\frame{
  \titlepage

  \vfill \hfill \includegraphics[height=6mm]{Figs/cc-zero.png} 

  \note{These Slides are for a medium length talk (30min) meant as an introduction to a reproducible research workflow.

    Source: {\tt https://github.com/aaronpeikert/repro-talk/releases}
}}
}
\begin{frame}[c]{Why do we trust science?}
Scientific claims should not be credible because of their originators' authority but by the \textcolor{hilit}{transparency} and \textcolor{vhilit}{replicability} of their supporting evidence.
\end{frame}

\begin{frame}{Reproduction ≠ Replication}
  \vspace{1cm}
  \includegraphics<1>[width=\textwidth]{Figs/replication-vs-reproduction1.pdf}
  \includegraphics<2>[width=\textwidth]{Figs/replication-vs-reproduction2.pdf}
  \includegraphics<3>[width=\textwidth]{Figs/replication-vs-reproduction3.pdf}
  \onslide<2>{
    \textcolor{vhilit}{Replication} can not be automated, but
    \textcolor{hilit}{reproducibility} can and should be automated.
  }
\end{frame}

\begin{frame}[c]
  \begin{center}
  \large
  \textcolor<2>{lolit}{``Insanity is doing the same thing over and over again and expecting different results."}
  \end{center}
  \textcolor<2>{lolit}{\hfill {\textendash} Albert Einstein (disputed)}\\
  \onslide<2>{
  \begin{center}
  As it turns out, doing the\\
    \textcolor{hilit}{{\large same thing}}\\
  is pretty complicated.
\end{center}}
\end{frame}

\begin{frame}[c]
  \onslide<1->To increase reproducibility, \textcolor<1>{vhilit}{Psychological Science} published a full issue of \textcolor<1>{hilit}{open data} articles.\\
  \vspace{5mm}
  \onslide<2-> When three researcher per article tried to reproduce:
  \onslide<2->  \begin{enumerate}
    \item \textcolor{vhilit}{1/14} was exactly reproducible.
    \item \textcolor{hilit}{3/14} were reproducible but incomplete or only with minor deviations.
  \end{enumerate}
  \vspace{5mm}
  \onslide<2->\textcolor{lolit}{Crüwell et. al. (2022)\textemdash{}https://psyarxiv.com/729qt}
\end{frame}

\begin{frame}[c]{Why do I mistrust supplementary code?}
Four different problems are all to common:\\
\vspace{5mm}
	\onslide<1->\textcolor<2->{lolit}{1. Multiple inconsistent versions of code and data}\\
	\onslide<2->\textcolor<3->{lolit}{2. Copy-and-paste errors}\\
	\onslide<3->\textcolor<4->{lolit}{3. Ambiguous order of code execution}\\
	\onslide<4->4. Broken dependencies\\
\end{frame}

\begin{frame}[c]{Lessons from software engeniering}
Four solutions:
  \begin{enumerate}
    \item Version control
    \item Dynamic document creation
    \item Workflow management
    \item Software management
  \end{enumerate}
	\vfill
	\textcolor{lolit}{\tiny Peikert, A., \& Brandmaier, A. M. (2021). A Reproducible Data Analysis Workflow. \textit{Quantitative and Computational Methods in Behavioral Sciences, 1, Article e3763.} https://doi.org/10.5964/qcmb.3763\\}
	\vspace{3mm}
	\textcolor{lolit}{\tiny{Peikert, A., \& van Lissa, C. J. \& Brandmaier, A. M. (2021). Reproducible Research in R: A Tutorial on How to Do the Same Thing More Than Once. \textit{Psych, 3, no. 4: 836-867.} https://doi.org/10.3390/psych3040053}\\}
\end{frame}

\begin{frame}[c]{Specify Everything}
  The relations between\\
  \textcolor{hilit}{code}, \textcolor{hilit}{data}, \textcolor{hilit}{results} and their \textcolor{hilit}{environment}\\
  need to be \textcolor{vhilit}{unambiguously} specified.
\end{frame}

\begin{frame}[c]{Why should I care?}
	\only<1>{
		Productivity:
		\begin{itemize}
			\item reuse
			\item easier collaboration
			\item avoid trouble (during review, questions after publication, etc.)
		\end{itemize}
	}
	\only<2>{
	Good scientific practice:
		\begin{itemize}
			\item reproducibility is a precondition for replication
			\item increases transparency and (longterm) accessibility
		\end{itemize}
	}
\end{frame}

\begin{frame}[c]{Lessons from software engeniering}
Four solutions:
  \begin{enumerate}
    \item \textcolor{vhilit}{Version control}
    \item \textcolor{vhilit}{Dynamic document creation}
    \item \textcolor{hilit}{Workflow management}
    \item \textcolor{hilit}{Software management}
  \end{enumerate}
  \hfill \includegraphics[width=5cm]{Figs/time-vs-machine.pdf}

\end{frame}

\begin{frame}[c]{Tools for R Users}
	In the R Universe and beyond, the most flexible tools are:
  \begin{itemize}
    \item Dynamic document creation = RMarkdown*
    \item Version control = Git**
    \item Workflow management = Make**
    \item Software management = Docker**
  \end{itemize}
  \vfill
  \textcolor{lolit}{
	* RMarkdown supports more then 40 languages e.g.:\\
	\hspace{10mm}Python, Julia, SAS, Scala \& Octave\\
	** Language agnostic
	}
\end{frame}

\begin{frame}[c]{RMarkdown\textemdash{}Literate Programming}
  Text and code are mixed\\
  in a single source document\\
  that can be \textcolor{hilit}{dynamically} compiled\\
  into various representations:
  \begin{itemize}
    \item (APA conformable) manuscripts
    \item presentations
    \item websites
    \item books
    \item posters
		\item CV
  \end{itemize}
\end{frame}

{
  \usebackgroundtemplate{\includegraphics[width=\paperwidth]{Figs/rmarkdown.png}}
  \begin{frame}[plain]
  \end{frame}
}
{
  \usebackgroundtemplate{\includegraphics[width=\paperwidth]{Figs/rmarkdown-rendered.png}}
  \begin{frame}[plain]
  \end{frame}
}
\begin{frame}[c]{Git/GitHub\textemdash{}Version Control}
  Version control is a system that records changes to a set of files
  over time so that you can recall specific versions later.\\
  \vspace{10mm}
  It guarantees that code and data are exactly the same version as used for
  publication.
\end{frame}

\begin{frame}[c, fragile]{Make\textemdash{}Workflow management}

Make is a ``recipe" language that describes how files depend on each other and how to resolve these dependencies.
\vspace{10mm}
\begin{lstlisting}[language=make,basicstyle=\ttfamily\scriptsize]
arrabiata.pdf: arrabiata.Rmd sauce.csv pasta.csv
    Rscript -e 'rmarkdown::render("arrabiata.Rmd")'

pasta.csv: cook_pasta.R
    Rscript -e 'source("cook_pasta.R")'

sauce.csv: cook_sauce.R canned_tomatoes.csv
    Rscript -e 'source("cook_sauce.R")'
\end{lstlisting}
\end{frame}

\begin{frame}[c, fragile]{Docker\textemdash{}Containerization}
	Docker is a lightweight virtual computer.\\
	Dockerfiles are ``recipes" that describe what to install on that virtual computer:
	\vspace{10mm}
	\begin{lstlisting}[language=make,basicstyle=\ttfamily\scriptsize]
FROM rocker/verse:4.1.3
ARG BUILD_DATE=2022-03-10
RUN install2.r --error --skipinstalled\
  here lavaan
WORKDIR /home/rstudio
\end{lstlisting}
\end{frame}

  \usebackgroundtemplate{\includegraphics[width=\paperwidth]{Figs/nutshell.pdf}}
  \begin{frame}[plain]
  \vspace{8cm}
  \scriptsize \hfill{}\textcolor{black}{From Peikert \& Brandmaier (2019) under CC-BY4.0}
  \end{frame}
}

\begin{frame}[c]{Advantages}
	\begin{center}
		\onslide<1->{\textcolor<2->{lolit}{Unambiguous }}
		\onslide<2->{\textcolor<3->{lolit}{Standardized }}
		\onslide<3->{\textcolor<4->{lolit}{Portable }}
		\onslide<4->{Automated }
	\end{center}
\end{frame}

\begin{frame}[c]
  \begin{center}
    \Huge \textcolor{hilit}{How?}
  \end{center}
\end{frame}

\begin{frame}[c, fragile]{Simplifying the tools}
\textcolor<2->{lolit}{These tools require extensive training and need much time to configure correctly.\\}
\onslide<2->The R package 'repro' abstracts away the concrete technical implementation:\\
\begin{lstlisting}[basicstyle=\ttfamily\scriptsize]
repro:
  packages:
    - ggplot2
    - aaronpeikert/repro@adb5fa569
  scripts:
    - R/clean.R
  data:
    mycars: data/mtcars.csvrepro:
\end{lstlisting}
The function \lstinline|repro::automate()| automatically infers Docker- and Makefile.
\end{frame}

\begin{frame}[c]{Disadvantages}
\begin{itemize}
	\item requires complex software infrastructure
	\item depends on for-profit services
	\item diverges from the standard manuscript workflow
\end{itemize}
\end{frame}

\begin{frame}[c]
  \begin{center}
    \Huge \textcolor{vhilit}{Questions?}
    \onslide<2>\Huge \textcolor{hilit}{Comments?}
  \end{center}
\end{frame}

\begin{frame}[c]{Pushing the limit}
  \onslide<1->Open Science is much more than \textcolor{hilit}{reproducibility}.
  \onslide<2->It is about making research as \textcolor{vhilit}{transparent} as possible.
\end{frame}

\begin{frame}[c]{Standard Procedure}
  \begin{enumerate}
    \item Plan study
    \item Gather data
    \item Analyze data
    \item Write paper
  \end{enumerate}
\end{frame}

\begin{frame}[c]{Forced Open Procedure}
  \begin{enumerate}
    \item Plan study
    \item Gather data
    \item Analyze data
    \item Write paper
    \item \textcolor{purple}{Publish data}
  \end{enumerate}
\end{frame}

\begin{frame}[c]{Open Science Procedure}
  \begin{enumerate}
    \item Plan study
    \item \textcolor{vhilit}{Preregister}
    \item Gather Data
    \item Analyze Data
    \item Write Paper
    \item Publish \textcolor{hilit}{usableish} data + \textcolor{hilit}{code}
  \end{enumerate}
\end{frame}

\begin{frame}[c]{Super Open Science Procedure}
  \begin{enumerate}
    \item Plan study
    \item \textcolor{vhilit}{Plan sample size}
    \item Preregister
    \item Gather data
    \item \textcolor{hilit}{Track things in Git}
    \item \textcolor{hilit}{Fully automate analysis}
    \item  Write paper as \textcolor{hilit}{R Markdown}
    \item Publish \textcolor{hilit}{reproducible} data + code
  \end{enumerate}
\end{frame}

\begin{frame}[c]{Hyper Open Science Procedure}
  \begin{enumerate}
    \item Track everything in Git
    \item Plan study
    \item Fully automate analysis
    \item Plan sample size
    \item Write paper as R Markdown (Preregister)
    \item Publish reproducible code (Preregister)
    \item \textcolor{hilit}{Gather data}
    \item Update R Markdown + write discussion
  \end{enumerate}
\end{frame}

\begin{frame}[c]{All in one}
\begin{columns}
\begin{column}{0.5\textwidth}
  \centering
  \textcolor{vhilit}{Standard Preregistration}\vspace{5mm} \\
hunches\\
↓\\
preregistration\\
↓\\
data\\
↓\\
article draft
\end{column}
\begin{column}{0.5\textwidth}
  \centering
\textcolor{hilit}{Preregistration as Code}\vspace{5mm} \\ 
simulated data\\
↓\\
article draft with mock results\\
↓\\
data\\
↓\\
article draft with real results
\end{column}
\end{columns}
\end{frame}

\begin{frame}[c]
  \begin{center}
    \Huge \textcolor{hilit}{Why?}
  \end{center}
\end{frame}

\begin{frame}[c]{Because}
  \begin{center}
    \Large \onslide<1-> Preregistrations are difficult to \textcolor{hilit}{write}.\\
    \Large \onslide<2-> Preregistrations are difficult to \textcolor{vhilit}{consume}.
  \end{center}
\end{frame}

\begin{frame}{Writing Standards}
  \begin{itemize}
    \item Preregistrations form their own novel scientific writing format
    \item Scientific writing is a skill that requires much training to master
    \item but there are no unifying standards on how to write a preregistration
  \end{itemize}
  \vspace{10mm}
  Solution: Simply write a journal article and follow the \textcolor{hilit}{established standards}
\end{frame}

\begin{frame}[c]{Preregistration vs. Result}
\begin{columns}
\begin{column}{0.5\textwidth}
  \centering{\textcolor{vhilit}{Natural Language}}
  \begin{itemize}
    \item varying level of detail
    \item ambigue
    \item multi interpretable
  \end{itemize}
\end{column}
\begin{column}{0.5\textwidth}
\centering{\textcolor{hilit}{Computer Code}}
  \begin{itemize}
    \item comprehensive
    \item comparable
    \item executable
  \end{itemize}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[c]{All in one}
\begin{columns}
\begin{column}{0.5\textwidth}
  \centering
  \textcolor{vhilit}{Standard Preregistration}\vspace{5mm} \\
hunches\\
↓\\
preregistration\\
↓\\
data\\
↓\\
article draft
\end{column}
\begin{column}{0.5\textwidth}
  \centering
\textcolor{hilit}{Preregistration as Code}\vspace{5mm} \\ 
simulated data\\
↓\\
article draft with mock results\\
↓\\
data\\
↓\\
article draft with real results
\end{column}
\end{columns}
\end{frame}

\begin{frame}[c]
  \begin{center}
    \Huge \textcolor{hilit}{Thanks!}
  \end{center}
\end{frame}

\begin{frame}[c]
  \begin{center}
    \Huge \textcolor{lolit}{Backup}
  \end{center}
\end{frame}

\begin{frame}[c]{Focus: Computing infrastructure}
	\centering
	\onslide<1>{\textcolor{vhilit}{Workflow management} + \textcolor{hilit}{software management\\}}
	\onslide<1>{=\\}
	\onslide<1->{distributed computation\\}
	\only<2>{\textcolor{vhilit}{\vspace{5mm}Workflow management} enables intelligent task scheduling\\
	\textcolor{hilit}{Software management} guarantees compatible software environment}
	\onslide<3->{on\\}
	\only<3>{Cloud Computing infrastructure\\}
	\only<4>{High Performance Computing cluster (HPC)\\}
\end{frame}

\begin{frame}[c]{HPC\textemdash{}Container}
  \begin{itemize}
  \item repro supports Singularity as a Docker alternative
  \item developing environment matches HPC environment exactly
  \item full freedome to use any software, even when not supported by HPC admin
  \end{itemize}
\end{frame}

\begin{frame}[c]{HPC\textemdash{}Workflow management}
  making dependencies between tasks explicit enables:
  \begin{itemize}
  \item intelligent caching
  \item automatic parralelization
  \item dynamic job scheduling
  \end{itemize}
  \vspace{5mm}
  Make is well supported by several job schedulers.\\
  \vspace{5mm}
  Pure R solutions like the packages \textcolor{vhilit}{targets} + \textcolor{hilit}{futureverse} offer even more convinience and are compatible with repro
\end{frame}

\begin{frame}[c]{Focus: Modularity}
\begin{itemize}
	\item<1-> repro is a modular system
	\item<2-> potential integration of other workflows\\
	\item<3-> ``Lego system of reproducibility tools"
\end{itemize}
\end{frame}

\begin{frame}[c]{Focus: Longterm Archive}
	\textcolor<2>{lolit}{All software is bundled into the container, therefore all we need is:}
	\begin{itemize}
		\item \textcolor<2>{lolit}{container software}
		\item \textcolor<2>{lolit}{storage infrastructure}
	\end{itemize}

	\onslide<2>{
	What happens when Docker and co. are not supported anymore?\\
	Containers can be converted into a full system image ensuring support for decades.
	}

\end{frame}


\begin{frame}[c]{References}
	\textcolor{lolit}{Slides:\\}\href{https://github.com/aaronpeikert/repro-talk}{\texttt{\textcolor{foreground}{https://github.com/aaronpeikert/repro-talk}}}
	\textcolor{lolit}{Package:\\}\href{https://github.com/aaronpeikert/repro-thesis}{\texttt{\textcolor{foreground}{https://github.com/aaronpeikert/repro-thesis}}}\\
	\textcolor{lolit}{Workflow:\\}\href{https://doi.org/10.31234/osf.io/8xzqy}{\texttt{\textcolor{foreground}{https://doi.org/10.31234/osf.io/8xzqy}}}
\end{frame}

\begin{frame}[c]
  \Huge
	\only<1>{Thank you}
	\only<2>{Questions?}
\end{frame}

\end{document}
